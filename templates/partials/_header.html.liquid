<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
    <meta name="format-detection" content="telephone=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <title>{% if page_title %}{{ page_title }} - {% endif %}theatr.us</title>
    
    {% if meta_description %}
    <meta name="description" content="{{ meta_description }}">
    {% endif %}
    
    {% comment %} Open Graph meta tags {% endcomment %}
    {% if og_title %}
    <meta property="og:title" content="{{ og_title }}">
    {% endif %}
    {% if og_description %}
    <meta property="og:description" content="{{ og_description }}">
    {% endif %}
    {% if og_image %}
    <meta property="og:image" content="{{ og_image }}">
    {% endif %}
    {% if og_image_width %}
    <meta property="og:image:width" content="{{ og_image_width }}">
    {% endif %}
    {% if og_image_height %}
    <meta property="og:image:height" content="{{ og_image_height }}">
    {% endif %}
    <meta property="og:type" content="{% if og_type %}{{ og_type }}{% else %}website{% endif %}">
    {% if og_url %}
    <meta property="og:url" content="{{ og_url }}">
    {% endif %}
    <meta property="og:site_name" content="theatr.us">
    
    {% comment %} Twitter Card meta tags {% endcomment %}
    <meta name="twitter:card" content="{% if twitter_card_type %}{{ twitter_card_type }}{% else %}summary_large_image{% endif %}">
    {% if twitter_title %}
    <meta name="twitter:title" content="{{ twitter_title }}">
    {% endif %}
    {% if twitter_description %}
    <meta name="twitter:description" content="{{ twitter_description }}">
    {% endif %}
    {% if twitter_image %}
    <meta name="twitter:image" content="{{ twitter_image }}">
    {% endif %}
    
    <!-- Favicons -->
    <link rel="icon" href="/static/favicon.svg" type="image/svg+xml">
    <link rel="icon" href="/favicon.ico" type="image/vnd.microsoft.icon">
    <link rel="icon" href="/favicon-16.png" sizes="16x16" type="image/png">
    <link rel="icon" href="/favicon-32.png" sizes="32x32" type="image/png">
    <link rel="icon" href="/favicon-48.png" sizes="48x48" type="image/png">
    <link rel="apple-touch-icon" href="/static/apple-touch-icon.svg">
    <link rel="manifest" href="/static/site.webmanifest">
    
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="/static/style.css">
    
    {% comment %} Page-specific CSS files {% endcomment %}
    {% if page_css %}
        {% for css_file in page_css %}
        <link rel="stylesheet" href="/static/{{ css_file }}">
        {% endfor %}
    {% endif %}
</head>
<body>
    <header>
        <nav>
            <h1><a href="/">theatr.us</a></h1>
            <ul>
                <li><a href="/gallery">Gallery</a></li>
                <li><a href="/about">About</a></li>
                <li><a href="/contact">Contact</a></li>
            </ul>
            <div class="user-menu">
                <button class="user-menu-toggle" onclick="toggleUserMenu()" aria-label="User menu">
                    <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <circle cx="12" cy="8" r="3"/>
                        <path d="M12 14c-4 0-7 2-7 4v1h14v-1c0-2-3-4-7-4z"/>
                    </svg>
                </button>
                <div class="user-menu-dropdown" id="userMenuDropdown">
                    <div id="userMenuContent">
                        <div class="user-info">Loading...</div>
                    </div>
                </div>
            </div>
        </nav>
    </header>
    <main>
    
    <script>
    // User menu functionality
    let userMenuOpen = false;
    
    function toggleUserMenu() {
        const dropdown = document.getElementById('userMenuDropdown');
        userMenuOpen = !userMenuOpen;
        
        if (userMenuOpen) {
            dropdown.classList.add('show');
            // Add click outside listener
            document.addEventListener('click', handleClickOutside);
        } else {
            dropdown.classList.remove('show');
            document.removeEventListener('click', handleClickOutside);
        }
    }
    
    function handleClickOutside(event) {
        const userMenu = document.querySelector('.user-menu');
        if (!userMenu.contains(event.target)) {
            userMenuOpen = false;
            document.getElementById('userMenuDropdown').classList.remove('show');
            document.removeEventListener('click', handleClickOutside);
        }
    }
    
    // Check authentication status and populate menu
    async function initUserMenu() {
        try {
            const response = await fetch('/api/verify');
            const data = await response.json();
            
            const menuContent = document.getElementById('userMenuContent');
            
            if (data.authorized && data.username) {
                menuContent.innerHTML = `
                    <div class="user-info">
                        Logged in as <span class="username">${data.username}</span>
                    </div>
                    <a href="/logout">Logout</a>
                `;
            } else {
                menuContent.innerHTML = `
                    <a href="/login">Login</a>
                `;
            }
        } catch (error) {
            console.error('Error checking auth status:', error);
            // Default to showing login
            document.getElementById('userMenuContent').innerHTML = `
                <a href="/login">Login</a>
            `;
        }
    }
    
    // Initialize on page load
    document.addEventListener('DOMContentLoaded', initUserMenu);
    </script>