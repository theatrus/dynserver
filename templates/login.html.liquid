{% assign page_title = "Login" %}
{% assign meta_description = "Login to access the photo gallery" %}
{% assign page_css = "login.css" | split: "," %}
{% include "_header.html.liquid" %}

<div class="container">
    <div class="login-container">
        <h1>Login</h1>
        
        <div id="loginFormContainer">
            <p>Enter your username or email address to receive a login link.</p>
            
            <form id="loginForm">
                <div class="form-group">
                    <label for="username">Username or Email:</label>
                    <input type="text" id="username" name="username" placeholder="username or email@example.com" required autofocus>
                </div>
                
                <button type="submit" class="btn-primary">Send Login Link</button>
            </form>
        </div>
        
        <div id="successContainer" style="display: none;">
            <div id="message" class="message success"></div>
            <p style="text-align: center; margin-top: 20px;">
                <a href="/_login" class="try-again-link">Try again</a>
            </p>
        </div>
        
        <div id="errorMessage" class="message error" style="display: none;"></div>
    </div>
</div>


<script>
document.getElementById('loginForm').addEventListener('submit', async function(e) {
    e.preventDefault();
    
    const username = document.getElementById('username').value.trim();
    const messageDiv = document.getElementById('message');
    const errorDiv = document.getElementById('errorMessage');
    const submitButton = e.target.querySelector('button[type="submit"]');
    const formContainer = document.getElementById('loginFormContainer');
    const successContainer = document.getElementById('successContainer');
    
    // Hide any previous error messages
    errorDiv.style.display = 'none';
    
    if (!username) {
        errorDiv.textContent = 'Please enter a username or email address';
        errorDiv.style.display = 'block';
        return;
    }
    
    submitButton.disabled = true;
    submitButton.textContent = 'Sending...';
    
    try {
        const response = await fetch('/_login/request', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
            },
            body: JSON.stringify({ username: username })
        });
        
        const data = await response.json();
        
        if (data.success) {
            // Hide the form and show success message
            formContainer.style.display = 'none';
            messageDiv.textContent = data.message;
            successContainer.style.display = 'block';
        } else {
            // Show error message below the form
            errorDiv.textContent = data.message || 'Login failed';
            errorDiv.style.display = 'block';
        }
        
    } catch (error) {
        errorDiv.textContent = 'An error occurred. Please try again.';
        errorDiv.style.display = 'block';
    } finally {
        submitButton.disabled = false;
        submitButton.textContent = 'Send Login Link';
    }
});
</script>

{% include "_footer.html.liquid" %}