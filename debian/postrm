#!/bin/bash

set -e

case "$1" in
    purge)
        # Remove user and group on purge
        if getent passwd tenrankai >/dev/null 2>&1; then
            deluser --system tenrankai || true
        fi
        
        if getent group tenrankai >/dev/null 2>&1; then
            delgroup --system tenrankai || true
        fi
        
        # Remove data directories on purge (with confirmation)
        if [ -d /var/lib/tenrankai ]; then
            echo "Removing /var/lib/tenrankai (this will delete all cached data)"
            rm -rf /var/lib/tenrankai || true
        fi
        
        if [ -d /var/log/tenrankai ]; then
            rm -rf /var/log/tenrankai || true
        fi
        
        # Note: /etc/tenrankai is left for manual cleanup
        if [ -d /etc/tenrankai ]; then
            echo "Configuration directory /etc/tenrankai preserved."
            echo "Remove manually if no longer needed: sudo rm -rf /etc/tenrankai"
        fi
        ;;
        
    remove|upgrade|failed-upgrade|abort-install|abort-upgrade|disappear)
        # Stop and disable service
        if command -v systemctl >/dev/null 2>&1; then
            systemctl stop tenrankai || true
            systemctl disable tenrankai || true
            systemctl daemon-reload || true
        fi
        ;;
esac

#DEBHELPER#

exit 0